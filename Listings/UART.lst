C51 COMPILER V9.60.7.0   UART                                                              09/11/2025 18:31:05 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\UART.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE UART.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\UART
                    -.lst) TABS(2) OBJECT(.\Objects\UART.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          #define RLEN 8
   4          
   5          unsigned char rbytes[RLEN];
   6          bit rflag = 0;
   7          
   8          void UartInit(void)   //9600bps@11.0592MHz
   9          {
  10   1        PCON |= 0x80;   //波特率倍速
  11   1        SCON = 0x50;    //8位数据,可变波特率
  12   1      //  AUXR &= 0xBF;   //定时器1时钟为Fosc/12,即12T
  13   1      //  AUXR &= 0xFE;   //串口1选择定时器1为波特率发生器
  14   1        TMOD &= 0x0F;   //清除定时器1模式位
  15   1        TMOD |= 0x20;   //设定定时器1为8位自动重装方式
  16   1        TL1 = 0xFA;   //设定定时初值
  17   1        TH1 = 0xFA;   //设定定时器重装值
  18   1        ET1 = 0;  //禁止定时器1中断
  19   1        ES = 1;     //使能UART中断
  20   1        EA = 1;     //使能全局中断
  21   1        TR1 = 1;    //启动定时器1
  22   1      }
  23          
  24          void Uart_SendBytes(unsigned char *dat)
  25          {
  26   1        while(*dat)
  27   1        {
  28   2          SBUF = *dat++;
  29   2          while(!TI);
  30   2          TI = 0;
  31   2        }
  32   1      
  33   1      }
  34          
  35          unsigned char* Uart_ReadBytes()
  36          {
  37   1        rflag = 0;
  38   1        return rbytes;
  39   1      }
  40          
  41          void Uart_Routine(void) interrupt 4
  42          {
  43   1        static unsigned char count = 0;
  44   1        if(!rflag)
  45   1        {
  46   2          if(RI)
  47   2          {
  48   3            RI = 0;
  49   3            rbytes[count] = SBUF;
  50   3            if((rbytes[0] == 0x23)&& count < RLEN)
  51   3            {
  52   4              if(rbytes[count] == 0x24)
  53   4              {
  54   5                rflag = 1;
C51 COMPILER V9.60.7.0   UART                                                              09/11/2025 18:31:05 PAGE 2   

  55   5                count = 0;
  56   5              }
  57   4              else
  58   4              {
  59   5                count++;
  60   5              }
  61   4            }
  62   3            else
  63   3            {
  64   4              count = 0;
  65   4            }   
  66   3          }
  67   2        }
  68   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    139    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
