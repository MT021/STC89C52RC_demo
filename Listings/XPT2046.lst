C51 COMPILER V9.54   XPT2046                                                               08/27/2025 19:36:52 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE XPT2046
OBJECT MODULE PLACED IN .\Objects\XPT2046.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE XPT2046.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\X
                    -PT2046.lst) TABS(2) OBJECT(.\Objects\XPT2046.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          #define XPT2046_XP    0x94
   4          #define XPT2046_YP    0xD4
   5          #define XPT2046_VBAT  0xA4
   6          #define XPT2046_AUX   0xE4
   7          
   8          sbit XPT2046_CS = P3^5;
   9          sbit XPT2046_DCLK = P3^6;
  10          sbit XPT2046_DIN = P3^4;
  11          sbit XPT2046_DOUT = P3^7;
  12          
  13          unsigned int g_ADC_AD1_Value = 0;
  14          
  15          void Timer0Init(void)   //10ms@11.0592MHz
  16          {
  17   1      
  18   1        TMOD &= 0xF0;   
  19   1        TMOD |= 0x01;   
  20   1        TL0 = 0x00;   
  21   1        TH0 = 0xDC;   
  22   1        TF0 = 0;  
  23   1        TR0 = 1;  
  24   1        ET0 = 1;
  25   1        EA = 1;
  26   1      }
  27          
  28          
  29          unsigned int xpt2046_readADC(unsigned char cmd)
  30          {
  31   1        unsigned char i;
  32   1        unsigned int adc = 0;
  33   1        
  34   1        XPT2046_DCLK = 0;
  35   1        XPT2046_CS = 0;
  36   1          
  37   1        for(i = 0;i < 8;i++)
  38   1        {
  39   2          XPT2046_DIN = cmd >> 7;
  40   2          cmd <<= 1;
  41   2          XPT2046_DCLK = 0;
  42   2          XPT2046_DCLK = 1;   
  43   2        }
  44   1      
  45   1        XPT2046_DCLK = 1;
  46   1        XPT2046_DCLK = 0;
  47   1        
  48   1        for(i = 0;i < 12;i++)
  49   1        {
  50   2          adc <<= 1;
  51   2          XPT2046_DCLK = 1;
  52   2          XPT2046_DCLK = 0;
  53   2          adc |= XPT2046_DOUT;  
  54   2        }
C51 COMPILER V9.54   XPT2046                                                               08/27/2025 19:36:52 PAGE 2   

  55   1        
  56   1        XPT2046_CS = 1;
  57   1        
  58   1        return adc;
  59   1      }
  60          
  61          void Timer0_Routine() interrupt 1
  62          {
  63   1        static unsigned char counts = 0;
  64   1        TL0 = 0x00;   
  65   1        TH0 = 0xDC;
  66   1        counts++;
  67   1        counts %= 50;
  68   1        if(0 == counts)
  69   1        {
  70   2          g_ADC_AD1_Value = xpt2046_readADC(XPT2046_VBAT);
  71   2        }
  72   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    152    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
